tool: impacket-getlapspassword
tags: [pentest, security, active-directory, impacket, enumeration, post-exploitation, laps]

actions:
# === BASIC AUTHENTICATION ===

 - title: impacket-GetLAPSPassword - basic authentication
   desc: |
     Extract all available LAPS passwords from the Active Directory environment using cleartext credentials. 
     This command queries the LDAP server for the ms-Mcs-AdmPwd attribute which stores the local administrator password.
     It is typically used after gaining initial domain credentials to escalate privileges on workstations or servers.
     Note that the user account provided must have read permissions on the computer objects' LAPS attributes.
   command: "impacket-GetLAPSPassword {{domain}}/{{username}}:{{password}}@{{dc_ip}}"

 - title: impacket-GetLAPSPassword - pass-the-hash authentication
   desc: |
     Authenticate to the Domain Controller using NTLM hashes instead of a plaintext password.
     This is the standard approach for "Pass-the-Hash" attacks when a user's NTLM hash has been recovered from memory or a SAM database.
     The format for the hash should be LMHASH:NTHASH (use an empty LM hash if only the NT hash is available).
     This method allows for credential reuse without needing to crack the original password.
   command: "impacket-GetLAPSPassword -hashes {{lmhash:nthash}} {{domain}}/{{username}}@{{dc_ip}}"

# === FILTERING AND OUTPUT ===

 - title: impacket-GetLAPSPassword - target specific computer
   desc: |
     Query the LAPS password for a specific computer name instead of listing all visible passwords.
     This reduces noise and network traffic when you are only interested in a single high-value target.
     The computer name should be provided without the trailing dollar sign ($) in most cases.
     It is highly recommended for large environments to avoid processing thousands of computer objects.
   command: "impacket-GetLAPSPassword -computer {{computer_name}} {{domain}}/{{username}}:{{password}}@{{dc_ip}}"

 - title: impacket-GetLAPSPassword - save results to file
   desc: |
     Execute the LAPS password extraction and redirect the output to a specified local file.
     This is useful for maintaining a record of discovered local administrator credentials for later stages of the engagement.
     The tool will format the output in a way that is easy to read or parse with other scripts.
     Ensure you have write permissions in the directory where you are attempting to save the output.
   command: "impacket-GetLAPSPassword -o {{output_file|laps_results.txt}} {{domain}}/{{username}}:{{password}}@{{dc_ip}}"

# === ADVANCED CONNECTION & KERBEROS ===

 - title: impacket-GetLAPSPassword - kerberos authentication
   desc: |
     Perform the LAPS query using Kerberos tickets instead of NTLM authentication.
     The tool will attempt to use the ticket pointed to by the KRB5CCNAME environment variable.
     This is useful in environments where NTLM is disabled or to avoid generating NTLM-based alerts in logs.
     You must ensure that the target parameter matches the SPN/hostname expected by the Kerberos ticket.
   command: "impacket-GetLAPSPassword -k -no-pass {{domain}}/{{username}}@{{dc_hostname}}"

 - title: impacket-GetLAPSPassword - use secure ldap (LDAPS)
   desc: |
     Force the tool to use LDAP over SSL (LDAPS) for the connection to the Domain Controller.
     This is often required for modern Windows Server versions (e.g., Server 2025) or environments where LDAP signing/encryption is enforced.
     If the target DC uses a self-signed certificate, you might encounter verification issues depending on your local configuration.
     Using LDAPS prevents the transmission of query data (including the passwords) in cleartext over the wire.
   command: "impacket-GetLAPSPassword -ldaps -dc-ip {{dc_ip}} {{domain}}/{{username}}:{{password}}@{{domain}}"

 - title: impacket-GetLAPSPassword - specify domain controller hostname
   desc: |
     Explicitly define the Domain Controller's hostname and IP address for the connection.
     This is useful when DNS resolution is not working correctly or when you need to target a specific DC in a multi-DC environment.
     Providing both -dc-ip and -dc-host ensures the tool knows exactly where to route the LDAP requests.
     This can also help avoid issues with Kerberos SPN validation.
   command: "impacket-GetLAPSPassword -dc-ip {{dc_ip}} -dc-host {{dc_hostname}} {{domain}}/{{username}}:{{password}}@{{domain}}"

# === DEBUGGING ===

 - title: impacket-GetLAPSPassword - debug mode with timestamps
   desc: |
     Run the tool with debug logging enabled and timestamps added to every line of output.
     This is critical for troubleshooting connection issues, permission errors, or protocol mismatches.
     The verbose output shows exactly what LDAP queries are being sent and the raw responses received.
     Use this if you suspect that passwords exist but are not being displayed by the standard output.
   command: "impacket-GetLAPSPassword -debug -ts {{domain}}/{{username}}:{{password}}@{{dc_ip}}"